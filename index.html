const board = document.getElementById('board');
const message = document.getElementById('message');
const resetBtn = document.getElementById('reset');
const startBtn = document.getElementById('start-game');
const clickSound = document.getElementById('click-sound');

let cells = Array(9).fill('');
let players, currentPlayer, gameActive;

const winningConditions = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

function createBoard() {
  board.innerHTML = '';
  cells.forEach((cell, index) => {
    const div = document.createElement('div');
    div.classList.add('cell');
    div.setAttribute('data-index', index);
    div.addEventListener('click', handleCellClick);
    board.appendChild(div);
  });
}

function handleCellClick(e) {
  const index = e.target.getAttribute('data-index');
  if(cells[index] !== '' || !gameActive) return;

  cells[index] = currentPlayer.symbol;
  e.target.textContent = currentPlayer.symbol;
  clickSound.play();

  if(checkResult()) return;

  currentPlayer = currentPlayer === players[0] ? players[1] : players[0];
  message.textContent = `Vez de ${currentPlayer.name} (${currentPlayer.symbol})`;
}

function checkResult() {
  let roundWon = false;

  for(let condition of winningConditions){
    const [a,b,c] = condition;
    if(cells[a] && cells[a] === cells[b] && cells[a] === cells[c]){
      roundWon = true;
      break;
    }
  }

  if(roundWon){
    message.textContent = `${currentPlayer.name} venceu!`;
    gameActive = false;
    return true;
  }

  if(!cells.includes('')){
    message.textContent = "Empate!";
    gameActive = false;
    return true;
  }

  return false;
}

function startGame(){
  clickSound.play();

  const p1Name = document.getElementById('player1-name').value || 'Jogador 1';
  const p2Name = document.getElementById('player2-name').value || 'Jogador 2';

  // Símbolos aleatórios
  const symbols = ['X','O'];
  const p1Symbol = symbols[Math.floor(Math.random()*2)];
  const p2Symbol = p1Symbol === 'X' ? 'O' : 'X';

  players = [
    {name: p1Name, symbol: p1Symbol},
    {name: p2Name, symbol: p2Symbol}
  ];

  cells = Array(9).fill('');
  createBoard();
  gameActive = true;
  currentPlayer = players[Math.floor(Math.random()*2)];

  message.textContent = `Vez de ${currentPlayer.name} (${currentPlayer.symbol})`;
}

function resetGame(){
  cells = Array(9).fill('');
  createBoard();
  gameActive = false;
  message.textContent = '';
}

startBtn.addEventListener('click', startGame);
resetBtn.addEventListener('click', resetGame);

createBoard();